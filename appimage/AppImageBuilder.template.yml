version: 1

AppDir:
  path: ./AppDir

  app_info:
    id: %PREFIX%
    name: Dwarf_Fortress
    icon: linux-dwarf-pack
    version: %VERSION%
    exec: bin/dash
    exec_args: "${APPDIR}/linux-dwarf-pack.sh"

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ bionic main restricted universe multiverse'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3b4fe6acc0b21f32'
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ bionic-updates main restricted universe multiverse'
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse'

    include: [%DEPENDENCIES%, dash, coreutils]
    exclude:
      - adwaita-icon-theme
      - hicolor-icon-theme
      - humanity-icon-theme
      # - phonon4qt5
      # - libkf5service-bin
      # - perl
      # - perl-base
      # - libpam-runtime

  files:
    exclude:
      - usr/lib/x86_64-linux-gnu/gconv
      - usr/share/man
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/NEWS.*
      - usr/share/doc/*/TODO.*
      - usr/share/metainfo/org.gnome.Terminal.appdata.xml
      - usr/include
      - %DFDIR%/libs/Dwarf_Fortress

  # force unmodified DF binary, or DFHack won't work
  after_runtime: |
      cp "%APPDIR%/../%DFDIR%/libs/Dwarf_Fortress" AppDir/%DFDIR%/libs/

  runtime:
    env:
#      APPDIR_LIBRARY_PATH: $APPDIR/lib/x86_64-linux-gnu:$APPDIR/usr/lib/x86_64-linux-gnu
      PYTHONHOME: '${APPDIR}/usr'
      PYTHONPATH: '${APPDIR}/usr/lib/python3.6'
      
script: |
  rm -fr AppDir
  rsync -qa %APPDIR%/* AppDir/

AppImage:
  arch: x86_64
  update-information: None
  sign-key: None
